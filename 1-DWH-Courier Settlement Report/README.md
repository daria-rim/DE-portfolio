# üì¶ DWH: Courier Settlement Report. –†–∞—Å—á—ë—Ç –≤—ã–ø–ª–∞—Ç –∫—É—Ä—å–µ—Ä–∞–º

> –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–∞–Ω–Ω—ã—Ö (DWH) —Ç—Ä–µ—Ç—å–∏–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º ‚Äî REST API –∫—É—Ä—å–µ—Ä—Å–∫–æ–π —Å–ª—É–∂–±—ã ‚Äî –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≤–∏—Ç—Ä–∏–Ω—ã `cdm.dm_courier_ledger` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–π –∫—É—Ä—å–µ—Ä–∞–º.

---

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –±—ã–ª–æ –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ **–¥–≤—É—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤**:
1. **MongoDB** ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
   - `restaurants`, `users`, `orders`
2. **PostgreSQL (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏)** ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–æ–≥–∞—â–µ–Ω–∏—è:
   - `ranks`, `users`

–ù–∞ –∏—Ö –æ—Å–Ω–æ–≤–µ –±—ã–ª–∞ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞ –ø–µ—Ä–≤–∞—è –≤–∏—Ç—Ä–∏–Ω–∞ ‚Äî `cdm.dm_settlement_report` ‚Äî –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –≤—ã–ø–ª–∞—Ç **—Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞–º**.

–í —Ä–∞–º–∫–∞—Ö —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è **—Ç—Ä–µ—Ç–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫**:  

3. **REST API –∫—É—Ä—å–µ—Ä—Å–∫–æ–π —Å–ª—É–∂–±—ã**, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π:
   - –°–ø–∏—Å–æ–∫ –∫—É—Ä—å–µ—Ä–æ–≤ (`/couriers`)
   - –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç–∞–≤–æ–∫ (`/deliveries`) —Å –¥–∞—Ç–æ–π –∑–∞–∫–∞–∑–∞, —Ä–µ–π—Ç–∏–Ω–≥–æ–º –∏ —á–∞–µ–≤—ã–º–∏

–¶–µ–ª—å ‚Äî **–ø–æ—Å—Ç—Ä–æ–∏—Ç—å –Ω–æ–≤—É—é –≤–∏—Ç—Ä–∏–Ω—É `cdm.dm_courier_ledger`**, —Å–æ–¥–µ—Ä–∂–∞—â—É—é –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å—É–º–º—ã –≤—ã–ø–ª–∞—Ç –∫–∞–∂–¥–æ–º—É –∫—É—Ä—å–µ—Ä—É –∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü –Ω–∞ –æ—Å–Ω–æ–≤–µ:
- –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–∫–∞–∑–∞—Ö (—É–∂–µ –≤ DWH),
- –¥–∞–Ω–Ω—ã—Ö –æ –¥–æ—Å—Ç–∞–≤–∫–∞—Ö (–∏–∑ –Ω–æ–≤–æ–≥–æ API),
- –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª, –∑–∞–≤–∏—Å—è—â–∏—Ö –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞ –∫—É—Ä—å–µ—Ä–∞.

> üí° –†–∞—Å—á—ë—Ç –≤–µ–¥—ë—Ç—Å—è **–ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ (`order_ts`)**, –∞ –Ω–µ –¥–æ—Å—Ç–∞–≤–∫–∏. –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `CLOSED`.

### üß± –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ DWH
- **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã DDS –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è**: –≤ `dds.dm_orders` –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è `courier_id`.
- **–ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –≤ DDS**:
  - `dds.dm_couriers` ‚Äî —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫—É—Ä—å–µ—Ä–æ–≤,
  - `dds.fct_deliveries` ‚Äî —Ñ–∞–∫—Ç—ã –¥–æ—Å—Ç–∞–≤–æ–∫ (—Å `rate`, `tip_sum`, `order_ts`).
- **–ù–æ–≤–∞—è –≤–∏—Ç—Ä–∏–Ω–∞ CDM**: `cdm.dm_courier_ledger`.

### üõ† –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
- **–ò—Å—Ç–æ—á–Ω–∏–∫–∏**: MongoDB, PostgreSQL, REST API
- **–•—Ä–∞–Ω–∏–ª–∏—â–µ**: PostgreSQL
- **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è**: Apache Airflow
- **–Ø–∑—ã–∫**: Python 3.9+
- **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**: SQL, REST, JSON, –ø–∞–≥–∏–Ω–∞—Ü–∏—è (limit/offset)

---

## üß™ –í—ã–≤–æ–¥—ã

- –£—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω **—Ç—Ä–µ—Ç–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö** –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é DWH-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ **–º–Ω–æ–≥–æ—Å–ª–æ–π–Ω–∞—è –º–æ–¥–µ–ª—å "—Å–Ω–µ–∂–∏–Ω–∫–∞"**, —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –Ω–æ–≤—ã–º–∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è–º–∏ –∏ —Å–≤—è–∑—è–º–∏.
- –í—Å–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ (–ø–æ—Ä–æ–≥–æ–≤—ã–µ –≤—ã–ø–ª–∞—Ç—ã, —Ä–µ–π—Ç–∏–Ω–≥–æ–≤–∞—è –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—è, –∫–æ–º–∏—Å—Å–∏–∏) –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ —Å–ª–æ–µ CDM.
- –†–µ—à–µ–Ω–∏–µ **—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –∏—Å—Ö–æ–¥–Ω—ã–µ DAG-–∏ –∏ –≤–∏—Ç—Ä–∏–Ω–∞ `dm_settlement_report` –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

---

## üè∑Ô∏è –¢–µ–≥–∏

`#dwh` `#etl` `#airflow` `#postgresql` `#mongodb` `#rest-api` `#data-engineering` `#python` `#courier-payment` `#cdm` `#dds`
